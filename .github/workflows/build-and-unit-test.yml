name: build and unit test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  DOTNETVERSION: 6.0.100-rc.2.21505.57

jobs:
  build-test:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install Visual Studio Preview
        shell: pwsh
        run: ./script/install-vs.ps1

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.1

      - name: maui-check
        shell: pwsh
        run: |
          & dotnet tool update --global redth.net.maui.check
          & maui-check --ci --non-interactive --fix --force-dotnet --skip vswin --skip xcode --skip edgewebview2 --skip androidemulator

      - name: build
        shell: pwsh
        run: ./script/build/build.ps1

      - name: unit test
        shell: pwsh
        run: ./script/build/unit-test.ps1
